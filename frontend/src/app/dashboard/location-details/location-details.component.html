<div class="container-fluid" *ngIf="location | async as location">
  <!-- Title -->
  <h1 class="inline-block">{{location.name}}</h1>
  <button class="btn btn-primary float-right" *ngIf="showAdmin" routerLink="/management/locations/{{location.name}}">{{'dashboard.locationDetails.buttons.manage' | translate}}</button>

  <!-- First layer: image, general info and overview of tags -->
  <div class="row">
    <div class="col-md-4 col-sm-12">
      <!-- Note that if the original url of the image (received from the
           REST API) resulted in an error in the dashboard-item, the attribute
            will be replaced with a default value. -->
      <div>
        <img *ngIf="location.imageUrl !== null"
            src="{{location.imageUrl}}" alt="Image of {{location.name}}"
            (error)="handleImageError(location)">
       <img *ngIf="location.imageUrl === null" [src]="altImageUrl" alt="Image of {{location.name}}">
       <div class="locationStatusBar"
             [classList]="'locationStatusBar ' + locationStatusColorClass()"></div>
      </div>

    </div>

    <div class="col-md-4 col-sm-12">
      <div class="container-fluid row">
        <div class="alert alert-info">
          {{'dashboard.locationDetails.info' | translate}}
        </div>

        <!-- Number of seats, number of lockers and address -->
        <ul>
          <li>{{'dashboard.numberOfSeats' | translate}}: {{location.numberOfSeats}}</li>
          <li *ngIf="showLockersManagement">{{'dashboard.numberOfLockers' | translate}}: {{location.numberOfLockers}}</li>
          <li>{{'dashboard.building' | translate}}: {{location.building.name}}</li>
          <li>{{'dashboard.address' | translate}}: {{location.building.address}}</li>
          <li>{{'dashboard.status' | translate}}: {{statusInCurrentLang | translate}}</li>
        </ul>
      </div>
    </div>

    <div class="col-md-4 col-sm12">
      <div class="container-fluid row">
        <div class="alert alert-info">
          {{'dashboard.locationDetails.tags' | translate}}
        </div>

        <!-- List of the tags -->
        <ul *ngIf="tags !== undefined">
          <li *ngFor="let tag of tags">
            {{currentLang === 'nl' ? tag.dutch : tag.english}}
          </li>
        </ul>
      </div>
    </div>
  </div>

  <hr>

  <!-- Description of the location, show the description based on the browser language -->
  <!-- A CKEditor is used, but is put in read-only mode and without a toolbar -->
  <h2>{{'dashboard.description' | translate}}</h2>

  <ckeditor [(ngModel)]="description.show"
            [editor]="editor"
            [disabled]="true" [config]="{toolbar: []}">
  </ckeditor>

  <hr>
  <div class="alert alert-warning" *ngIf="!this.authenticationService.isLoggedIn()">
    Voordat er reservaties kunnen geplaatst worden voor deze locatie, dient u ingelogd te zijn.
  </div>

  <!-- Calendar -->
  <div class="row">
    <app-calendar [events]="events" (onTimeslotPicked)="timeslotPicked($event)"></app-calendar>
  </div>

  <div class="row" style="padding-top: 10px;">
    <button
    class="btn btn-primary float-right"
    [disabled]="updateReservationIsPossible()"
    (click)="commitReservations(confirm)"
    >
    {{'reservations.reservationButton' | translate}}
  </button>
  </div>

  <!-- If clicked on reservationButton, give some feedback -->
  <div class="row" style="margin-top: 10px">
    <div class="alert alert-success" *ngIf="showSuccess">
      {{'dashboard.locationDetails.calendar.reservation.successMessage' | translate}}
    </div>

    <div class="alert alert-error" *ngIf="showError">
      {{'dashboard.locationDetails.calendar.reservation.errorMessage' | translate}}
    </div>
  </div>



  <hr>

  <!-- Google Maps Frame, based on address:
         - https://developers.google.com/maps/documentation/embed/get-started
         - https://stackoverflow.com/a/21141399/9356123

       To bypass XSS for a trusted URL:
          - https://angular.io/guide/security#xss -->
  <div class="row">
    <h1>{{'dashboard.location' | translate}}</h1>
    <iframe
      width="100%" height="450" style="border:0"
      [src]="getGoogleMapsUrl(location)" class="e2e-iframe-trusted-src col-md-12 col-sm-12" allowfullscreen>
    </iframe>
  </div>
</div>

<ng-template #confirm>
  <div class="modal-header">
    {{'dashboard.locationDetails.calendar.reservation.header' | translate}}
  </div>
  <div class="modal-body text-center">
    <p>{{'dashboard.locationDetails.calendar.reservation.updateMessage' | translate }}</p>
    <div *ngIf='newReservations.length !== 0'>
      <hr>
      <p>{{'dashboard.locationDetails.calendar.reservation.updateAddMessage' | translate }}</p>
      <div class="justify-content-center">
        <mat-chip-list aria-orientation="vertical">
          <mat-chip class="align-center" *ngFor="let reservation of newReservations" selected>
            {{formatReservation(reservation)}}
          </mat-chip>
        </mat-chip-list>
      </div>
    </div>
    <div *ngIf='removedReservations.length !== 0'>
      <hr>
      <p>{{'dashboard.locationDetails.calendar.reservation.updateDeleteMessage' | translate }}</p>
      <mat-chip-list class="mat-chip-list-wrapper">
        <mat-chip *ngFor="let reservation of removedReservations" selected color="warn">
          {{formatReservation(reservation)}}
        </mat-chip>
      </mat-chip-list>
    </div>
    <hr>
    <p>{{'dashboard.locationDetails.calendar.reservation.updateConfirmMessage' | translate }}</p>
    <button type="button" class="btn btn-default" (click)="confirmReservationChange()" >{{ 'general.yes' | translate }}</button>
    <button type="button" class="btn btn-primary" (click)="declineReservationChange()" >{{ 'general.no' | translate}}</button>
  </div>
  <div class="modal-footer">
    <div class="alert alert-warning text-center">
      {{'dashboard.locationDetails.calendar.reservation.updateWarningMessage' | translate}}
    </div>
  </div>
</ng-template>
