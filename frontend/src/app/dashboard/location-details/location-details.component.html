<div class="container-fluid" *ngIf="location | async as location">
  <!-- Title -->
  <h1 class="inline-block">{{location.name}}</h1>
  <button class="btn btn-primary float-right" *ngIf="showAdmin"
          routerLink="/management/locations/{{location.name}}">{{'dashboard.locationDetails.buttons.manage' | translate}}</button>

  <!-- First layer: image, general info and overview of tags -->
  <div class="row">
    <div class="col-md-4 col-sm-12">
      <!-- Note that if the original url of the image (received from the
           REST API) resulted in an error in the dashboard-item, the attribute
           will be replaced with a default value. -->
      <div>
        <img *ngIf="location.imageUrl !== null"
             src="{{location.imageUrl}}" alt="Image of {{location.name}}"
             (error)="handleImageError(location)">
        <img *ngIf="location.imageUrl === null" [src]="altImageUrl" alt="Image of {{location.name}}">
        <div class="locationStatusBar"
             [classList]="'locationStatusBar ' + locationStatusColorClass()">
        </div>
      </div>
    </div>

    <div class="col-md-4 col-sm-12">
      <div class="container-fluid row">
        <div class="alert alert-info">
          {{'dashboard.locationDetails.info' | translate}}
        </div>

        <!-- General information about the location -->
        <table class="table borderless">
          <tbody>
          <tr>
            <td><span class="glyphicon glyphicon-time" aria-hidden="true"></span></td>
            <td>{{statusObs | async | formatStatus | async}}</td>
          </tr>
          <tr>
            <td><span class="glyphicon glyphicon-user" aria-hidden="true"></span></td>
            <td>{{location.numberOfSeats}}</td>
          </tr>
          <tr *ngIf="showLockersManagement">
            <td><span class="glyphicon glyphicon-lock" aria-hidden="true"></span></td>
            <td>{{location.numberOfLockers}}</td>
          </tr>
          <tr>
            <td><span class="glyphicon glyphicon-home" aria-hidden="true"></span></td>
            <td>{{location.building.name}}<br/>{{location.building.address}}
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="col-md-4 col-sm12">
      <div class="container-fluid row">
        <div class="alert alert-info">
          {{'dashboard.locationDetails.tags' | translate}}
        </div>

        <!-- List of the tags -->
        <div *ngIf="tags !== undefined" class="tags" fxLayout="column" fxLayoutAlign="flex-start flex-start">
          <p class="tag" *ngFor="let tag of tags">
            {{currentLang === 'nl' ? tag.dutch : tag.english}}
          </p>
        </div>
      </div>
    </div>
  </div>

  <hr>

  <!-- Description of the location, show the description based on the browser language -->
  <!-- A CKEditor is used, but is put in read-only mode and without a toolbar -->
  <div *ngIf="showDescription(description.show)">
    <h2>{{'dashboard.description' | translate}}</h2>

    <ckeditor [(ngModel)]="description.show"
              [editor]="editor"
              [disabled]="true" [config]="{toolbar: []}">
    </ckeditor>

    <hr>
  </div>

  <div class="alert alert-warning" *ngIf="!loggedIn()">
    {{'dashboard.locationDetails.loginWarning' | translate}}
  </div>

  <div class="alert alert-info" *ngIf="loggedIn()">
    {{'dashboard.locationDetails.refreshWarning' | translate}}
  </div>

  <!-- Calendar -->
  <div class="row">
    <app-calendar [events]="events" (onTimeslotPicked)="timeslotPicked($event)"></app-calendar>
  </div>

  <div class="row" style="padding-top: 10px;">
    <button *ngIf="loggedIn()"
            class="btn btn-primary float-right"
            [disabled]="updateReservationIsPossible()"
            (click)="commitReservations(confirm)">
      {{'reservations.reservationButton' | translate}}
    </button>
  </div>

  <!-- If clicked on reservationButton, give some feedback -->
  <div class="row" style="margin-top: 10px">
    <div class="alert alert-success" *ngIf="showSuccess">
      {{'dashboard.locationDetails.calendar.reservation.successMessage' | translate}}
    </div>

    <div class="alert alert-error" *ngIf="showError">
      {{'dashboard.locationDetails.calendar.reservation.errorMessage' | translate}}
    </div>
  </div>

  <hr>

  <!-- Google Maps Frame, based on address:
         - https://developers.google.com/maps/documentation/embed/get-started
         - https://stackoverflow.com/a/21141399/9356123

       To bypass XSS for a trusted URL:
          - https://angular.io/guide/security#xss -->
  <div class="row">
    <h1>{{'dashboard.location' | translate}}</h1>
    <iframe
      width="100%" height="450" style="border:0"
      [src]="getGoogleMapsUrl(location)" class="e2e-iframe-trusted-src col-md-12 col-sm-12" allowfullscreen>
    </iframe>
  </div>
</div>

<ng-template #confirm>
  <div class="modal-header">
    {{'dashboard.locationDetails.calendar.reservation.header' | translate}}
  </div>
  <div class="modal-body text-center">
    <p>{{'dashboard.locationDetails.calendar.reservation.updateMessage' | translate }}</p>
    <div *ngIf='newReservations.length !== 0'>
      <hr>
      <p>{{'dashboard.locationDetails.calendar.reservation.updateAddMessage' | translate }}</p>
      <div class="justify-content-center">
        <mat-chip-list aria-orientation="vertical">
          <mat-chip class="align-center" *ngFor="let reservation of newReservations" selected>
            {{formatReservation(reservation)}}
          </mat-chip>
        </mat-chip-list>
      </div>
    </div>
    <div *ngIf='removedReservations.length !== 0'>
      <hr>
      <p>{{'dashboard.locationDetails.calendar.reservation.updateDeleteMessage' | translate }}</p>
      <mat-chip-list class="mat-chip-list-wrapper">
        <mat-chip *ngFor="let reservation of removedReservations" selected color="warn">
          {{formatReservation(reservation)}}
        </mat-chip>
      </mat-chip-list>
    </div>
    <hr>
    <p>{{'dashboard.locationDetails.calendar.reservation.updateConfirmMessage' | translate }}</p>
    <button type="button" class="btn btn-default"
            (click)="confirmReservationChange()">{{ 'general.yes' | translate }}</button>
    <button type="button" class="btn btn-primary"
            (click)="declineReservationChange()">{{ 'general.no' | translate}}</button>
  </div>
  <div class="modal-footer">
    <div class="alert alert-warning text-center">
      {{'dashboard.locationDetails.calendar.reservation.updateWarningMessage' | translate}}
    </div>
  </div>
</ng-template>
